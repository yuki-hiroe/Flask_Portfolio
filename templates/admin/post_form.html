
{% extends "admin/base.html" %}

{% block title %}記事{{ action }}{% endblock %}
{% block page_title %}記事{{ action }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-{{ 'plus' if action == '作成' else 'edit' }} me-2"></i>
                    記事{{ action }}
                </h5>
                <a href="{{ url_for('admin_posts') }}" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-arrow-left me-1"></i>戻る
                </a>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-8">
                            <!-- タイトル -->
                            <div class="mb-3">
                                <label for="title" class="form-label">記事タイトル</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="title" 
                                       name="title" 
                                       value="{{ post[1] if post else '' }}" 
                                       required 
                                       placeholder="記事のタイトルを入力してください">
                            </div>
                            
                            <!-- 内容 -->
                            <div class="mb-3">
                                <label for="content" class="form-label">記事内容</label>
                                <textarea class="form-control" 
                                          id="content" 
                                          name="content" 
                                          rows="15" 
                                          required 
                                          placeholder="記事の内容を入力してください...">{{ post[2] if post else '' }}</textarea>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    改行は自動的に変換されます
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <!-- 公開設定 -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-cog me-2"></i>公開設定
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="checkbox" 
                                               id="is_published" 
                                               name="is_published"
                                               {{ 'checked' if post and post[5] else '' }}>
                                        <label class="form-check-label" for="is_published">
                                            この記事を公開する
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        チェックを外すと下書きとして保存されます
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 作成・更新情報 -->
                            {% if post %}
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-info me-2"></i>記事情報
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <p class="small text-muted mb-2">
                                        <strong>作成日:</strong><br>
                                        {{ post[3] }}
                                    </p>
                                    <p class="small text-muted mb-0">
                                        <strong>最終更新:</strong><br>
                                        {{ post[4] }}
                                    </p>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- 操作ボタン -->
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>
                                    {% if action == '作成' %}記事を作成{% else %}変更を保存{% endif %}
                                </button>
                                
                                {% if post %}
                                <div class="row">
                                    <div class="col-6">
                                        <form method="POST" action="{{ url_for('admin_post_toggle', post_id=post[0]) }}">
                                            <button type="submit" 
                                                    class="btn btn-outline-{{ 'warning' if post[5] else 'success' }} w-100">
                                                <i class="fas fa-{{ 'eye-slash' if post[5] else 'eye' }} me-1"></i>
                                                {{ '非公開' if post[5] else '公開' }}
                                            </button>
                                        </form>
                                    </div>
                                    <div class="col-6">
                                        <button type="button" 
                                                class="btn btn-outline-danger w-100"
                                                onclick="confirmDelete({{ post[0] }}, '{{ post[1] }}')">
                                            <i class="fas fa-trash me-1"></i>削除
                                        </button>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% if post %}
<!-- 削除確認モーダル -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">記事を削除</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>本当に「<strong id="deleteTitle"></strong>」を削除しますか？</p>
                <p class="text-muted small">この操作は取り消すことができません。</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                <form id="deleteForm" method="POST" style="display: inline-block;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>削除する
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/post_form.js') }}"></script>

<!-- デバッグ情報 -->
<script>
console.log('Post form page loaded');
{% if post %}
console.log('Edit mode: Post ID {{ post[0] }}');
{% else %}
console.log('Create mode');
{% endif %}
</script>
{% endblock %}